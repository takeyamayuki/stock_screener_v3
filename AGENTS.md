# Repository Guidelines

## Project Structure & Module Organization
- `scripts/`: Core Python entrypoints (`fetch_symbols_ppx.py`, `screener.py`).
- `config/`: Inputs such as `symbols.txt` generated by fetch step.
- `reports/`: Daily outputs (`screen_YYYYMMDD.csv/.md`).
- `cache/`: Local API caches (e.g., Alpha Vantage income and overview JSON).
- `.github/workflows/`: CI workflow (`screener.yml`) scheduled for JST 08:30.
- `README.md`: Setup and usage overview.

## Build, Test, and Development Commands
- Install deps: `python -m pip install -U pip && pip install -r requirements.txt`
- Fetch today’s symbols:
  - `export PERPLEXITY_API_KEY=...` (optional), `export ALPHAVANTAGE_KEY=...`
  - `python scripts/fetch_symbols_ppx.py` → writes `config/symbols.txt`
- Run screener locally:
  - `export THROTTLE_SECONDS=13 MAX_SYMBOLS=60 ALPHAVANTAGE_MAX_DAILY_CALLS=20`
  - `python scripts/screener.py` → writes to `reports/`
- CI: `.github/workflows/screener.yml` installs deps, fetches symbols, runs screener, commits results.

## Coding Style & Naming Conventions
- Python 3.11, PEP 8, 4‑space indentation.
- Prefer descriptive names; avoid one‑letter variables.
- Keep pure, testable helpers (e.g., `annual_checks`, `quarterly_checks`, `score`).
- Respect existing caching and rate‑limit patterns (`THROTTLE_SECONDS`, daily budgets, `_cached_at`).

## Testing Guidelines
- No formal suite included. For logic changes, add lightweight tests under `tests/` using `pytest` (if introduced) with files named `test_*.py` targeting small units (e.g., `annual_checks`).
- Keep tests deterministic; mock network calls. Do not expand tooling without discussion.

## Commit & Pull Request Guidelines
- Commits: short, imperative summaries and scoped changes.
  - Examples: `screener: handle AV daily budget`, `docs: add AGENTS guide`.
  - CI uses messages like `daily screen: <UTC timestamp>` for automated runs.
- PRs: include purpose, user impact, before/after notes, and sample command output (e.g., a table row in `reports/*.md`). Link issues when applicable.
- Avoid committing secrets or large data; keep diffs minimal and focused.

## Security & Configuration Tips
- Provide keys via env vars or GitHub Secrets: `PERPLEXITY_API_KEY`, `ALPHAVANTAGE_KEY`.
- Be mindful of vendor rate limits; default `THROTTLE_SECONDS` 13–15s is recommended.
- Caches live under `cache/`; do not store credentials; safe to commit JSON caches already in repo.

## Architecture Overview
- Pipeline: fetch 52‑week‑high JP codes → write `config/symbols.txt` → run screener (Alpha Vantage fundamentals + Perplexity digest) → output CSV/Markdown → CI commits artifacts.
